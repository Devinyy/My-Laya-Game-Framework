{
  "code": "import { ui } from \"../../../ui/layaMaxUI\";\r\nimport { LwgDate, LwgDialogue, LwgScene, LwgWX } from \"../../Lwg/Lwg\";\r\nimport { GameAni2D } from \"../Control/GameAni2D\";\r\nimport { GameData } from \"../Control/GameData\";\r\nimport { GameEff2D } from \"../Control/GameEff2D\";\r\nimport { GameEnum } from \"../Control/GameEnum\";\r\nimport { GameEvent } from \"../Control/GameEvent\";\r\nimport GameSceneName from \"../Control/GameSceneName\";\r\nexport default class Lottery extends LwgScene.SceneBase {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.openChestNum = 0;\r\n    }\r\n    lwgOnAwake() {\r\n        this.createChest();\r\n        this.updateKey();\r\n        const baseReward = GameData.Lottery.getBestReward;\r\n        this.owner.imgBestRewardPic.skin = baseReward.picSkin;\r\n        if (baseReward.type !== GameEnum.ItemType.Skin) {\r\n            this.owner.imgBestRewardPic.centerY = -16;\r\n            this.owner.lbBsetRewardNum.text = 'x' + baseReward.number.toString();\r\n        }\r\n    }\r\n    lwgOpenAniAfter() {\r\n        GameEff2D.bothBlinkOnSprite2(this.owner.boxTitle, new Laya.Point(Laya.stage.width * 2 / 3, 0), this);\r\n    }\r\n    lwgButton() {\r\n        this.btnOnceUp(this.owner.btnReturn, () => {\r\n            this.closeScene();\r\n        });\r\n        this.btnOnUpAD(this.owner.btnAdGet, () => {\r\n            if (this.openChestNum < 9) {\r\n                GameData.Lottery.KeyNum += 3;\r\n                this.updateKey();\r\n                this.evNotify(GameEvent.updateKeyNumStart);\r\n            }\r\n        });\r\n    }\r\n    createChest() {\r\n        const moveX = 20;\r\n        const moveY = 10;\r\n        for (let i = 0; i < 3; i++) {\r\n            for (let j = 0; j < 3; j++) {\r\n                const chestView = new ui.Views.LotteryRenderObjUI;\r\n                const point = new Laya.Point(this.owner.chestBox.width / 3 * i + chestView.width / 2 + moveX, this.owner.chestBox.height / 3 * j + chestView.height / 2 + moveY);\r\n                chestView.pos(point.x, point.y);\r\n                this.owner.chestBox.addChild(chestView);\r\n                chestView.lbNum.visible = false;\r\n                chestView.imgRewardIcon.visible = false;\r\n                if (GameData.Lottery.KeyNum >= 3) {\r\n                    this.btnOnUp(chestView, () => {\r\n                        if (GameData.Lottery.KeyNum > 0) {\r\n                            this.onClickChest(chestView, false);\r\n                        }\r\n                        else {\r\n                            if (chestView['beOpen']) {\r\n                                LwgDialogue.showTips('奖励已领取！');\r\n                            }\r\n                            else {\r\n                                LwgWX.AD.showVideo(() => {\r\n                                    this.onClickChest(chestView, true);\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    if (i == 2 && j == 2) {\r\n                        this.owner.btnReturn.visible = true;\r\n                        this.owner.chestBox.on(Laya.Event.CLICK, this, () => {\r\n                            LwgDialogue.showTips('请凑足3把金钥匙！');\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    onClickChest(chestView, AD) {\r\n        if (!chestView['beOpen']) {\r\n            this.openChestNum++;\r\n            chestView['beOpen'] = true;\r\n            chestView.lbNum.visible = true;\r\n            chestView.imgRewardIcon.visible = true;\r\n            chestView.chestIcon.visible = false;\r\n            let item;\r\n            if (this.openChestNum === 9) {\r\n                item = GameData.Lottery.getBestReward;\r\n                this.owner.btnAdGet.visible = false;\r\n                this.owner.boxKey.visible = false;\r\n                this.owner.lbOpenAll.visible = true;\r\n            }\r\n            else {\r\n                item = GameData.Lottery.ranReward;\r\n            }\r\n            chestView.lbNum.text = 'X' + item.number.toString();\r\n            chestView.imgRewardIcon.skin = item.picSkin;\r\n            if (!AD) {\r\n                GameData.Lottery.KeyNum--;\r\n            }\r\n            this.evNotify(GameEvent.updateKeyNumStart);\r\n            if (item.type === GameEnum.ItemType.Skin) {\r\n                const obj = {\r\n                    itme: item,\r\n                };\r\n                this.openOverlayScene(GameSceneName.BeRewarded, obj);\r\n                chestView.lbNum.visible = false;\r\n                chestView.imgRewardIcon.top = 10;\r\n                chestView.imgRewardIcon.bottom = 10;\r\n                chestView.imgRewardIcon.left = 10;\r\n                chestView.imgRewardIcon.right = 10;\r\n            }\r\n            else {\r\n                GameAni2D.getRewardAni(item.ID, item.number);\r\n            }\r\n            chestView.imgAd.visible = false;\r\n            this.updateKey();\r\n            chestView.zOrder = LwgDate.Now.time;\r\n            GameEff2D.oneFireworks2(chestView, new Laya.Point(chestView.width / 2, chestView.height / 2));\r\n        }\r\n        else {\r\n            LwgDialogue.showTips('奖励已领取！');\r\n        }\r\n    }\r\n    updateKey() {\r\n        if (GameData.Lottery.KeyNum === 0) {\r\n            this.owner.btnReturn.visible = true;\r\n            if (this.openChestNum < 9) {\r\n                this.owner.btnAdGet.visible = true;\r\n            }\r\n        }\r\n        else {\r\n            this.owner.btnAdGet.visible = false;\r\n        }\r\n        for (let index = 1; index < 4; index++) {\r\n            if (index > GameData.Lottery.KeyNum) {\r\n                this.owner[`key${index}`].visible = false;\r\n            }\r\n            else {\r\n                this.owner[`key${index}`].visible = true;\r\n            }\r\n        }\r\n        for (let index = 0; index < this.owner.chestBox.numChildren; index++) {\r\n            const element = this.owner.chestBox.getChildAt(index);\r\n            if (GameData.Lottery.KeyNum === 0) {\r\n                if (!element['beOpen']) {\r\n                    element.imgAd.visible = true;\r\n                }\r\n            }\r\n            else {\r\n                element.imgAd.visible = false;\r\n            }\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/ui/layaMaxUI.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Lwg/Lwg.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameAni2D.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameData.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameEff2D.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameEnum.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameEvent.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameSceneName.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameType.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Game3D/Control3D.ts"
  ]
}

{
  "code": "import { Lwg3D, LwgAni3D, LwgCurrency, LwgDialogue, LwgEvent, LwgTimer, LwgTools, LwgWX } from \"../../Lwg/Lwg\";\r\nimport { GameData } from \"../Control/GameData\";\r\nimport { GameEnum } from \"../Control/GameEnum\";\r\nimport { GameEvent } from \"../Control/GameEvent\";\r\nimport { GameRes } from \"../Control/GameRes\";\r\nimport { Effect3D } from \"./Effect3D\";\r\nimport { MainScene } from \"./MainScene\";\r\nexport class Role {\r\n    constructor() {\r\n        Role.ins = this;\r\n        this.changeScene(MainScene.ins.scene);\r\n        StateControl.Init();\r\n    }\r\n    changeScene(scene) {\r\n        this.scene = scene;\r\n        this.cameraPoint = this.scene.getChildByName('CameraPoint');\r\n        this.camera = this.cameraPoint.getChildByName('Main Camera');\r\n        if (!this.scene.getChildByName('Role')) {\r\n            this.role = new Laya.Sprite3D;\r\n            this.role.name = 'Role';\r\n            this.scene.addChild(this.role);\r\n        }\r\n        else {\r\n            this.role = this.scene.getChildByName('Role');\r\n        }\r\n    }\r\n    setState(state, args = []) {\r\n        StateControl.stateClear();\r\n        switch (state) {\r\n            case GameEnum.RoleState.Suspend:\r\n                StateControl.Suspend.ins.action();\r\n                break;\r\n            case GameEnum.RoleState.Ready:\r\n                StateControl.stateReset();\r\n                StateControl.Ready.ins.action();\r\n                break;\r\n            case GameEnum.RoleState.Start:\r\n                StateControl.stateReset();\r\n                StateControl.Start.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Run, args);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Run:\r\n                StateControl.MoveCrosswise.ins.action();\r\n                StateControl.MoveForward.ins.action(args);\r\n                StateControl.Run.ins.action();\r\n                break;\r\n            case GameEnum.RoleState.Diamond:\r\n                StateControl.Diamond.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Run);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Wall:\r\n                StateControl.Wall.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Defeated);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Bubble:\r\n                StateControl.MoveCrosswise.ins.action();\r\n                StateControl.Bubble.ins.action(args, (args) => {\r\n                    StateControl.MoveForward.ins.action(args);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Door:\r\n                StateControl.Door.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Run);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Slope:\r\n                StateControl.Slope.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Run);\r\n                });\r\n                StateControl.MoveCrosswise.ins.action();\r\n                break;\r\n            case GameEnum.RoleState.KeyFood:\r\n                StateControl.KeyFood.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Run);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Destination:\r\n                StateControl.MoveCrosswise.ins.action();\r\n                StateControl.Destination.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Dance);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Dance:\r\n                StateControl.Dance.ins.action(args, () => {\r\n                    this.setState(GameEnum.RoleState.Victory);\r\n                });\r\n                break;\r\n            case GameEnum.RoleState.Victory:\r\n                StateControl.Victory.ins.action();\r\n                break;\r\n            case GameEnum.RoleState.Defeated:\r\n                StateControl.Defeated.ins.action();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.state = state;\r\n    }\r\n    playAniRole(aniName) {\r\n        return LwgTools.D3.playAnimator(this.skin, aniName);\r\n    }\r\n    playAniCrossFade(aniName) {\r\n        const animator = this.skin.getComponent(Laya.Animator);\r\n        animator.crossFade(aniName, 1);\r\n    }\r\n    playAniByCommon(roleSkin, aniName) {\r\n        return;\r\n        const aniCilp = GameData.Animator.getClipNameByRoleNameAndAni(roleSkin.name, aniName);\r\n        return LwgTools.D3.playAnimator(roleSkin, aniCilp);\r\n    }\r\n    get colorIndex() {\r\n        return this._colorIndex ? this._colorIndex : 1;\r\n    }\r\n    set colorIndex(val) {\r\n        this._colorIndex = val;\r\n        LwgEvent.notify(GameEvent.updateRoleHP, [this._colorIndex]);\r\n    }\r\n    changeColor(colorIdnex = GameEnum.Colour.red) {\r\n        this.colorIndex = colorIdnex;\r\n        if (this.dress.name !== 'Dress001') {\r\n            this.hair.meshRenderer.material = GameRes.Material[`dress0${colorIdnex}`].instance;\r\n            this.dress.skinnedMeshRenderer.material = GameRes.Material[`hair0${colorIdnex}`].instance;\r\n        }\r\n    }\r\n    changeSkin() {\r\n        if (!this.skin) {\r\n            this.skin = GameRes.Prefab3D.role01.instance.clone();\r\n            this.role.addChild(this.skin);\r\n            const box = this.skin.getChildByName('box');\r\n            if (!box.getComponent(RoleScript)) {\r\n                box.addComponent(RoleScript);\r\n            }\r\n        }\r\n        for (let index = 0; index < this.skin.numChildren; index++) {\r\n            const part = this.skin.getChildAt(index);\r\n            if (part.name.substr(0, 5) === 'Dress') {\r\n                if (part.name === GameData.Skin.pitchDressName) {\r\n                    part.active = true;\r\n                    this.dress = part;\r\n                }\r\n                else {\r\n                    part.active = false;\r\n                }\r\n            }\r\n        }\r\n        const hairParent = LwgTools.Node.findChild3D(this.skin, 'mixamorig:HeadTop_End');\r\n        for (let index = 0; index < hairParent.numChildren; index++) {\r\n            const part = hairParent.getChildAt(index);\r\n            if (part.name === GameData.Skin.pitchHairName) {\r\n                part.active = true;\r\n                this.hair = part.getChildAt(0);\r\n            }\r\n            else {\r\n                part.active = false;\r\n            }\r\n        }\r\n    }\r\n    changeRainbowSkin() {\r\n        if (!this.skin) {\r\n            this.skin = GameRes.Prefab3D.role01.instance.clone();\r\n            this.role.addChild(this.skin);\r\n            const box = this.skin.getChildByName('box');\r\n            if (!box.getComponent(RoleScript)) {\r\n                box.addComponent(RoleScript);\r\n            }\r\n        }\r\n        for (let index = 0; index < this.skin.numChildren; index++) {\r\n            const part = this.skin.getChildAt(index);\r\n            if (part.name.substr(0, 5) === 'Dress') {\r\n                if (part.name === 'Dress001') {\r\n                    part.active = true;\r\n                }\r\n                else {\r\n                    part.active = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    showFontHP(num, sp3D, diffX, diffY) {\r\n        return;\r\n        const sp3d0 = sp3D ? sp3D : Role.ins.role;\r\n        const point = LwgTools.D3.getPosToScreen(sp3d0.transform.position, Role.ins.camera);\r\n        let color = '#ff5547';\r\n        if (num >= 0) {\r\n            color = '#56ff47';\r\n        }\r\n        const numStr = num > 0 ? '+' + num.toString() : num.toString();\r\n        let diffX0 = diffX === undefined ? 100 : diffX;\r\n        let diffY0 = diffY === undefined ? 100 : diffY;\r\n        const scale = sp3d0.transform.localScaleX;\r\n        diffX0 *= scale;\r\n        diffY0 *= scale;\r\n        LwgDialogue.FloatWord.createFontSystem(point.x + diffX0, point.y + diffY0, { content: numStr, color: color }, 1, false);\r\n        LwgWX.shakeShort();\r\n    }\r\n    showFontAttribute(str) {\r\n        return;\r\n        let color = '#56ff47';\r\n        const point = LwgTools.D3.getPosToScreen(Role.ins.role.transform.position, Role.ins.camera);\r\n        point.y -= this.role.transform.localScaleX * 100;\r\n        point.y -= 50;\r\n        LwgDialogue.FloatWord.createFontSystem(point.x, point.y, { content: str, color: color }, 1, false);\r\n        LwgWX.shakeShort();\r\n    }\r\n    updateLevelDisplay() {\r\n        const point = LwgTools.D3.getPosToScreen(Role.ins.role.transform.position, Role.ins.camera);\r\n        point.y -= this.role.transform.localScaleX * 100;\r\n        point.y -= 50;\r\n        LwgEvent.notify(GameEvent.updateRoleDataDisplay, [point]);\r\n    }\r\n}\r\nclass RoleScript extends Lwg3D.Object3D {\r\n    onTriggerEnter(other) {\r\n        const otherOwner = other.owner;\r\n        const name = otherOwner.name;\r\n        if (otherOwner['alreadyEnter']) {\r\n            return;\r\n        }\r\n        otherOwner['alreadyEnter'] = true;\r\n        if (name.substr(0, 6) == 'paopao') {\r\n            Role.ins.setState(GameEnum.RoleState.Bubble, [otherOwner]);\r\n        }\r\n        else if (name.substr(0, 11) == 'ZhangaiBian') {\r\n            Role.ins.setState(GameEnum.RoleState.Door, [otherOwner]);\r\n        }\r\n        else if (name.substr(0, 11) == 'destination') {\r\n            Role.ins.setState(GameEnum.RoleState.Destination, [otherOwner]);\r\n        }\r\n        else if (name.substr(0, 13) == 'zhangai_xiepo') {\r\n            Role.ins.setState(GameEnum.RoleState.Slope, [otherOwner]);\r\n        }\r\n        else if (name.substr(0, 8) == 'zhangai0') {\r\n            Role.ins.setState(GameEnum.RoleState.Wall, [otherOwner]);\r\n        }\r\n        else if (name.substr(0, 7) == 'KeyFood') {\r\n            Role.ins.setState(GameEnum.RoleState.KeyFood, [otherOwner]);\r\n        }\r\n    }\r\n    onTriggerExit(other) {\r\n        return;\r\n        const otherOwner = other.owner;\r\n        const name = otherOwner.name;\r\n        if (name.substr(0, 12) === 'yanjiang') {\r\n            if (otherOwner['alreadyExit']) {\r\n                return;\r\n            }\r\n            otherOwner['alreadyExit'] = true;\r\n        }\r\n    }\r\n}\r\nexport class aniScript extends Lwg3D.Object3D {\r\n    lwgOnAwake() {\r\n    }\r\n    attackEnd() {\r\n        const animator = this.owner.getComponent(Laya.Animator);\r\n        const state = GameData.Animator.getClipNameByRoleNameAndAni(this.owner.name, GameEnum.RoleAni.idle);\r\n        animator.crossFade(state, 1);\r\n    }\r\n}\r\nexport var StateControl;\r\n(function (StateControl) {\r\n    function stateReset() {\r\n        for (const key in StateControl) {\r\n            if (Object.prototype.hasOwnProperty.call(StateControl, key)) {\r\n                const state = StateControl[key];\r\n                if (state['ins'] && state['ins']['reset']) {\r\n                    state['ins']['reset']();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    StateControl.stateReset = stateReset;\r\n    function stateClear() {\r\n        for (const key in StateControl) {\r\n            if (Object.prototype.hasOwnProperty.call(StateControl, key)) {\r\n                const state = StateControl[key];\r\n                if (state['ins'] && state['ins']['actionStop']) {\r\n                    state['ins']['actionStop']();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    StateControl.stateClear = stateClear;\r\n    function Init() {\r\n        for (const key in StateControl) {\r\n            if (Object.prototype.hasOwnProperty.call(StateControl, key)) {\r\n                const state = StateControl[key];\r\n                const name = state['name'];\r\n                if (name && name && name !== 'Init' && name !== 'stateClear' && name !== 'stateBase') {\r\n                    new state();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    StateControl.Init = Init;\r\n    class stateBase {\r\n        action(args, continueCb, endCb) { }\r\n        ;\r\n    }\r\n    StateControl.stateBase = stateBase;\r\n    class Suspend {\r\n        constructor() {\r\n            Suspend.ins = this;\r\n        }\r\n        action() {\r\n        }\r\n    }\r\n    StateControl.Suspend = Suspend;\r\n    class Ready {\r\n        constructor() {\r\n            Ready.ins = this;\r\n        }\r\n        action() {\r\n            Role.ins.cameraPoint.transform.position = new Laya.Vector3(2, -7, -7);\r\n            Role.ins.cameraPoint.transform.localRotationEuler = new Laya.Vector3(-15, 147.5, 4.8);\r\n            Role.ins.role.transform.localPosition = new Laya.Vector3(0, 0, 0);\r\n            Role.ins.role.transform.localScale = new Laya.Vector3(1, 1, 1);\r\n            Role.ins.role.transform.localRotationEuler = new Laya.Vector3(0, 0, 0);\r\n            Role.ins.changeSkin();\r\n            Role.ins.changeColor();\r\n            Role.ins.playAniRole(GameEnum.RoleAni.dance);\r\n            Laya.timer.frameLoop(1, this, () => {\r\n                Role.ins.updateLevelDisplay();\r\n            });\r\n        }\r\n        actionStop() {\r\n            Laya.timer.clearAll(this);\r\n        }\r\n    }\r\n    StateControl.Ready = Ready;\r\n    class Start {\r\n        constructor() {\r\n            Start.ins = this;\r\n        }\r\n        action(args, endCb) {\r\n            Laya.timer.frameLoop(1, this, () => {\r\n                Role.ins.updateLevelDisplay();\r\n            });\r\n            const time = 1000;\r\n            LwgAni3D.moveTo(Role.ins.cameraPoint, new Laya.Vector3(0, 0, 0), time, this, null, () => {\r\n            });\r\n            LwgAni3D.rotateTo(Role.ins.cameraPoint, new Laya.Vector3(0, 0, 0), time, this, null, () => {\r\n                endCb && endCb();\r\n            });\r\n        }\r\n        actionStop() {\r\n            Laya.timer.clearAll(this);\r\n        }\r\n    }\r\n    StateControl.Start = Start;\r\n    class MoveForward {\r\n        constructor() {\r\n            this.sprintCaller = {};\r\n            MoveForward.ins = this;\r\n            this.reset();\r\n        }\r\n        get sprintTime() {\r\n            if (GameData.Level.mode === GameEnum.LevelMode.endless) {\r\n                return 50;\r\n            }\r\n            else {\r\n                return 50;\r\n            }\r\n        }\r\n        reset() {\r\n            this.speedBase = 0.5 * (1 + GameData.Skill.getSkillAdditionByType(GameEnum.SkillType.speed));\r\n            this.sprintAddSpeed = 0.5;\r\n            this.speed = this.speedBase;\r\n        }\r\n        action(args = []) {\r\n            Laya.timer.frameLoop(1, this, this.actionCb);\r\n            if (args[0] === GameEnum.MoveForwardArgs.rightBubble) {\r\n                this.sprintAddSpeed = 0.3;\r\n                this.sprintProps();\r\n            }\r\n            else if (args[0] === GameEnum.MoveForwardArgs.errorBubble) {\r\n                this.sprintAddSpeed = 0;\r\n                this.sprintProps();\r\n            }\r\n        }\r\n        actionCb() {\r\n            LwgEvent.notify(GameEvent.addMileageCur, [this.speed]);\r\n            Role.ins.cameraPoint.transform.translate(new Laya.Vector3(0, 0, this.speed), false);\r\n            Role.ins.role.transform.translate(new Laya.Vector3(0, 0, this.speed), false);\r\n            Role.ins.updateLevelDisplay();\r\n        }\r\n        sprintProps() {\r\n            this.sprintEff && this.sprintEff.destroy(true);\r\n            Laya.timer.clearAll(this.sprintCaller);\r\n            this.speed = this.speedBase + this.sprintAddSpeed;\r\n            this.sprint = true;\r\n            Laya.timer.once(this.sprintTime, this.sprintCaller, () => {\r\n                this.sprint = false;\r\n                LwgTimer.frameNumLoop(1, 15, this.sprintCaller, () => {\r\n                    this.speed - this.sprintAddSpeed / 15;\r\n                }, () => {\r\n                    this.speed = this.speedBase;\r\n                    this.sprintEff && this.sprintEff.destroy(true);\r\n                    Role.ins.playAniRole(GameEnum.RoleAni.run);\r\n                });\r\n            });\r\n        }\r\n        stopSprint() {\r\n            Laya.timer.clearAll(this.sprintCaller);\r\n        }\r\n        actionStop() {\r\n            Laya.timer.clear(this, this.actionCb);\r\n        }\r\n    }\r\n    StateControl.MoveForward = MoveForward;\r\n    class MoveCrosswise {\r\n        constructor() {\r\n            this.isDestination = false;\r\n            MoveCrosswise.ins = this;\r\n            this.reset();\r\n        }\r\n        reset() {\r\n            this.speed = 0.06;\r\n            StateControl.gMoveScope = [-10, 10];\r\n            StateControl.gMoveCameraScope = [-6, 6];\r\n            this.isDestination = false;\r\n        }\r\n        action() {\r\n            Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.stageMove);\r\n            Laya.stage.on(Laya.Event.MOUSE_UP, this, this.stageUp);\r\n            Laya.stage.on(Laya.Event.MOUSE_OUT, this, this.stageUp);\r\n        }\r\n        stageMove(event) {\r\n            if (this.isDestination) {\r\n                return;\r\n            }\r\n            if (this.mouseX) {\r\n                this.setScopeLimit(Role.ins.cameraPoint, event);\r\n                this.setScopeLimit(Role.ins.role, event);\r\n                this.mouseX = event.stageX;\r\n            }\r\n            else {\r\n                this.mouseX = event.stageX;\r\n            }\r\n        }\r\n        setScopeLimit(target, e) {\r\n            let croMouseX = this.mouseX;\r\n            let diffX = e.stageX - croMouseX;\r\n            let targetX = 0;\r\n            if (target == Role.ins.cameraPoint) {\r\n                targetX = target.transform.position.x - diffX * this.speed * 0.6;\r\n            }\r\n            else {\r\n                targetX = target.transform.position.x - diffX * this.speed;\r\n            }\r\n            target.transform.position = new Laya.Vector3(targetX, target.transform.position.y, target.transform.position.z);\r\n            const posTarget = target.transform.position.clone();\r\n            if (target == Role.ins.cameraPoint) {\r\n                if (target.transform.position.x < StateControl.gMoveCameraScope[0]) {\r\n                    target.transform.position = new Laya.Vector3(StateControl.gMoveCameraScope[0], posTarget.y, posTarget.z);\r\n                }\r\n                if (target.transform.position.x > StateControl.gMoveCameraScope[1]) {\r\n                    target.transform.position = new Laya.Vector3(StateControl.gMoveCameraScope[1], posTarget.y, posTarget.z);\r\n                }\r\n            }\r\n            else {\r\n                if (target.transform.position.x < StateControl.gMoveScope[0]) {\r\n                    target.transform.position = new Laya.Vector3(StateControl.gMoveScope[0], posTarget.y, posTarget.z);\r\n                }\r\n                if (target.transform.position.x > StateControl.gMoveScope[1]) {\r\n                    target.transform.position = new Laya.Vector3(StateControl.gMoveScope[1], posTarget.y, posTarget.z);\r\n                }\r\n            }\r\n        }\r\n        stageUp(e) {\r\n            this.mouseX = null;\r\n        }\r\n        actionStop() {\r\n            this.mouseX = null;\r\n            Laya.stage.off(Laya.Event.MOUSE_MOVE, this, this.stageMove);\r\n            Laya.stage.off(Laya.Event.MOUSE_UP, this, this.stageUp);\r\n            Laya.stage.off(Laya.Event.MOUSE_OUT, this, this.stageUp);\r\n        }\r\n    }\r\n    StateControl.MoveCrosswise = MoveCrosswise;\r\n    class Run {\r\n        constructor() {\r\n            Run.ins = this;\r\n        }\r\n        action() {\r\n            Role.ins.playAniRole(GameEnum.RoleAni.run);\r\n        }\r\n    }\r\n    StateControl.Run = Run;\r\n    class Slope {\r\n        constructor() {\r\n            this.high = 20;\r\n            this.moveLen = 70;\r\n            Slope.ins = this;\r\n        }\r\n        action(args, cuntinueCb) {\r\n            const time1 = 150;\r\n            const time2 = 500;\r\n            cuntinueCb && cuntinueCb();\r\n            LwgAni3D.moveToY(Role.ins.role, this.high, time1, this, Laya.Ease.quadOut, () => {\r\n                LwgAni3D.moveToY(Role.ins.role, 0, time2, this, Laya.Ease.quadIn, () => { });\r\n            });\r\n            LwgAni3D.moveZ(Role.ins.role, this.moveLen, time1 + time2, this);\r\n            const cameraDiffY = Role.ins.cameraPoint.transform.position.y - Role.ins.role.transform.position.y;\r\n            LwgAni3D.moveToY(Role.ins.cameraPoint, this.high + cameraDiffY, time1, this, Laya.Ease.quadOut, () => {\r\n                LwgAni3D.moveToY(Role.ins.cameraPoint, cameraDiffY, time2, this, Laya.Ease.quadIn, () => { });\r\n            });\r\n            LwgAni3D.moveZ(Role.ins.cameraPoint, this.moveLen, time1 + time2, this);\r\n        }\r\n    }\r\n    StateControl.Slope = Slope;\r\n    class RoadNarrows {\r\n        constructor() {\r\n            this.arr0 = [];\r\n            this.arr1 = [];\r\n            RoadNarrows.ins = this;\r\n        }\r\n        reset() {\r\n            this.arr0 = [];\r\n            this.arr1 = [];\r\n        }\r\n        action(ags = [], cuntinueCb) {\r\n            if (ags[0] === 1) {\r\n                this.arr1.push(1);\r\n                const limitR = 4;\r\n                let limitC = 2;\r\n                let time = 100;\r\n                const timeBase = 100;\r\n                if (Role.ins.role.transform.position.x > limitR) {\r\n                    time = Math.abs(limitR - Role.ins.role.transform.position.x) * timeBase;\r\n                    LwgAni3D.moveToX(Role.ins.role, limitR, time, this, null, () => {\r\n                        cuntinueCb && cuntinueCb();\r\n                    });\r\n                    limitC = limitR - Role.ins.role.transform.position.x;\r\n                    LwgAni3D.moveX(Role.ins.cameraPoint, limitC, time, this);\r\n                }\r\n                else if (Role.ins.role.transform.position.x < -limitR) {\r\n                    time = Math.abs(-limitR - Role.ins.role.transform.position.x) * timeBase;\r\n                    LwgAni3D.moveToX(Role.ins.role, -limitR, time, this, null, () => {\r\n                        cuntinueCb && cuntinueCb();\r\n                    });\r\n                    limitC = -limitR - Role.ins.role.transform.position.x;\r\n                    LwgAni3D.moveX(Role.ins.cameraPoint, limitC, time, this);\r\n                }\r\n                else {\r\n                    cuntinueCb && cuntinueCb();\r\n                }\r\n            }\r\n            else {\r\n                cuntinueCb && cuntinueCb();\r\n                this.arr0.push(0);\r\n            }\r\n            if (this.arr0.length < this.arr1.length) {\r\n                StateControl.gMoveScope = [-4, 4];\r\n                StateControl.gMoveCameraScope = [-2, 2];\r\n            }\r\n            else {\r\n                StateControl.gMoveScope = [-9, 9];\r\n                StateControl.gMoveCameraScope = [-6, 6];\r\n            }\r\n        }\r\n    }\r\n    StateControl.RoadNarrows = RoadNarrows;\r\n    class Diamond {\r\n        constructor() {\r\n            this.addNum = 5;\r\n            this.sumNum = 0;\r\n            Diamond.ins = this;\r\n        }\r\n        reset() {\r\n            this.sumNum = 0;\r\n        }\r\n        action(args = [], continueCb) {\r\n            GameData.Sound.playSoundByID(2);\r\n            const diamond = args[0];\r\n            diamond.removeSelf();\r\n            this.sumNum += this.addNum;\r\n            continueCb && continueCb();\r\n            const point = LwgTools.D3.getPosToScreen(Role.ins.role.transform.position, Role.ins.camera);\r\n            LwgCurrency.Diamond.playGetSingleAni(Laya.stage, 1, 40, 35, 'Game/UI/img_icon_money_01.png', new Laya.Point(point.x, point.y - 250), new Laya.Point(100, 100), null, () => {\r\n                LwgEvent.notify(GameEvent.updateDiamond, [this.sumNum]);\r\n            });\r\n        }\r\n    }\r\n    StateControl.Diamond = Diamond;\r\n    class Wall {\r\n        constructor() {\r\n            Wall.ins = this;\r\n        }\r\n        action(args = [], defeatedCb) {\r\n            GameData.Sound.playSoundByID(15);\r\n            MoveForward.ins.stopSprint();\r\n            const posZ = -10;\r\n            const high = Role.ins.role.transform.position.y;\r\n            const time = 200 + high * 50;\r\n            Role.ins.playAniRole(GameEnum.RoleAni.fall);\r\n            LwgAni3D.moveZ(Role.ins.role, posZ, time, this, Laya.Ease.quadOut, () => {\r\n                defeatedCb && defeatedCb();\r\n                GameData.Sound.playSoundByID(18);\r\n            });\r\n            LwgAni3D.moveZ(Role.ins.cameraPoint, posZ - 10, time, this);\r\n            LwgAni3D.moveY(Role.ins.role, -high, time, this);\r\n            LwgAni3D.moveY(Role.ins.cameraPoint, -high, time, this);\r\n        }\r\n    }\r\n    StateControl.Wall = Wall;\r\n    class Bubble {\r\n        constructor() {\r\n            this.addNum = 1;\r\n            this.subNum = -1;\r\n            this._bubblesNum = 0;\r\n            this._rainbowEnergyNum = 0;\r\n            this.rainbowEnergyMaxNum = 25;\r\n            this.rainbowCaller = {};\r\n            this.errorCaller = {};\r\n            this.isDestination = false;\r\n            Bubble.ins = this;\r\n        }\r\n        reset() {\r\n            this.rainbowEnergyNum = Math.round(this.rainbowEnergyMaxNum * GameData.Skill.getSkillAdditionByType(GameEnum.SkillType.energy));\r\n            this.bubblesNum = 0;\r\n        }\r\n        get bubblesNum() {\r\n            return this._bubblesNum;\r\n        }\r\n        set bubblesNum(val) {\r\n            const num = val - this._bubblesNum;\r\n            this.rainbowEnergyNum += num;\r\n            this._bubblesNum = val;\r\n            LwgEvent.notify(GameEvent.bubblesNum, [this._bubblesNum, num, this.rainbowEnergyNum / this.rainbowEnergyMaxNum, this.isDestination]);\r\n        }\r\n        get rainbowEnergyNum() {\r\n            return this._rainbowEnergyNum ? this._rainbowEnergyNum : 0;\r\n        }\r\n        set rainbowEnergyNum(val) {\r\n            if (val >= this.rainbowEnergyMaxNum) {\r\n                val = this.rainbowEnergyMaxNum;\r\n            }\r\n            if (val < 0) {\r\n                val = 0;\r\n            }\r\n            this._rainbowEnergyNum = val;\r\n            LwgEvent.notify(GameEvent.storageNum, [this._rainbowEnergyNum]);\r\n        }\r\n        get isRainbow() {\r\n            return this._isRainbow;\r\n        }\r\n        set isRainbow(val) {\r\n            if (val) {\r\n                this._isRainbow = val;\r\n                Laya.timer.clearAll(this.rainbowCaller);\r\n            }\r\n            Laya.timer.once(3000, this.rainbowCaller, () => {\r\n                this._isRainbow = false;\r\n                Role.ins.changeSkin();\r\n            });\r\n        }\r\n        action(args = [], continueCb) {\r\n            const bubble = args[0].parent;\r\n            LwgWX.shakeShort();\r\n            if (this.isDestination) {\r\n                LwgTools.D3.playAnimator(bubble, GameEnum.BubbleAni.retract);\r\n                Effect3D.ins.play_Right(bubble.transform.position);\r\n                GameData.Sound.playSoundByID(14);\r\n            }\r\n            else {\r\n                let cbArgs = [];\r\n                let high = 0.2;\r\n                var right = () => {\r\n                    LwgTools.D3.playAnimator(bubble, GameEnum.BubbleAni.retract);\r\n                    cbArgs = [GameEnum.MoveForwardArgs.rightBubble];\r\n                    Effect3D.ins.play_Right(bubble.transform.position);\r\n                };\r\n                if (this.isRainbow) {\r\n                    GameData.Sound.playSoundByID(14);\r\n                    right();\r\n                }\r\n                else {\r\n                    if (bubble.colorIndex === Role.ins.colorIndex) {\r\n                        this.bubblesNum += this.addNum;\r\n                        right();\r\n                    }\r\n                    else {\r\n                        LwgTools.D3.playAnimator(bubble, GameEnum.BubbleAni.ball);\r\n                        this.bubblesNum += this.subNum;\r\n                        cbArgs = [GameEnum.MoveForwardArgs.errorBubble];\r\n                        GameData.Sound.playSoundByID(8);\r\n                    }\r\n                }\r\n                const time = 50;\r\n                Laya.timer.once(time, this.errorCaller, () => {\r\n                    LwgAni3D.moveY(Role.ins.role, high, time, this.errorCaller, null, () => {\r\n                        LwgAni3D.moveToY(Role.ins.role, 0, time, this.errorCaller);\r\n                    });\r\n                });\r\n                Role.ins.playAniRole(GameEnum.RoleAni.slide);\r\n                continueCb && continueCb(cbArgs);\r\n            }\r\n        }\r\n    }\r\n    StateControl.Bubble = Bubble;\r\n    class Door {\r\n        constructor() {\r\n            Door.ins = this;\r\n        }\r\n        action(args = [], cuntinueCb) {\r\n            const door = args[0];\r\n            LwgWX.shakeShort();\r\n            GameData.Sound.playSoundByID(16);\r\n            this.changeForm(door);\r\n            cuntinueCb && cuntinueCb();\r\n        }\r\n        changeForm(door) {\r\n            const index = +door.name.substr(13, 1);\r\n            Role.ins.changeColor(index);\r\n        }\r\n    }\r\n    StateControl.Door = Door;\r\n    class KeyFood {\r\n        constructor() {\r\n            KeyFood.ins = this;\r\n        }\r\n        action(args = [], continueCb) {\r\n            continueCb && continueCb();\r\n            const key = args[0].parent;\r\n            key.removeSelf();\r\n            LwgEvent.notify(GameEvent.pickedKey);\r\n            GameData.Sound.playSoundByID(10);\r\n        }\r\n    }\r\n    StateControl.KeyFood = KeyFood;\r\n    class Destination {\r\n        constructor() {\r\n            Destination.ins = this;\r\n        }\r\n        reset() {\r\n            Bubble.ins.isDestination = false;\r\n        }\r\n        action(args = [], continueCb) {\r\n            Role.ins.changeRainbowSkin();\r\n            Bubble.ins.isDestination = true;\r\n            let num = 25;\r\n            const roadLen = num == 0 ? 30 : 38;\r\n            const high = 3 * (num - 1);\r\n            const len = 8 * num;\r\n            const speedBase = (MoveForward.ins.speed * 60) * 2;\r\n            const time1 = 1000 * roadLen / speedBase;\r\n            LwgAni3D.moveZ(Role.ins.role, roadLen, time1, this, null, () => {\r\n                if (num === 0) {\r\n                    continueCb();\r\n                }\r\n                else {\r\n                    const time2 = 1000 * len / speedBase;\r\n                    LwgEvent.notify(GameEvent.reduceStorage, [time2 + 100]);\r\n                    LwgAni3D.moveY(Role.ins.role, high, time2, this, null, () => {\r\n                        if (num === Bubble.ins.rainbowEnergyMaxNum) {\r\n                            MoveCrosswise.ins.isDestination = true;\r\n                            const len997 = 65;\r\n                            const time3 = 1000 * len997 / speedBase;\r\n                            LwgAni3D.moveZ(Role.ins.role, len997, time3, this, null, () => {\r\n                                continueCb();\r\n                            });\r\n                            LwgAni3D.moveToX(Role.ins.role, 0, time3 / 2, this);\r\n                            LwgAni3D.moveZ(Role.ins.cameraPoint, len997, time3, this);\r\n                            LwgAni3D.moveZ(Role.ins.cameraPoint, len997, time3, this);\r\n                            LwgAni3D.moveToX(Role.ins.cameraPoint, 0, time3 / 2, this);\r\n                        }\r\n                        else {\r\n                            continueCb();\r\n                        }\r\n                    });\r\n                    LwgAni3D.moveZ(Role.ins.role, len, time2, this);\r\n                    LwgAni3D.moveY(Role.ins.cameraPoint, high, time2, this);\r\n                    LwgAni3D.moveZ(Role.ins.cameraPoint, len, time2, this);\r\n                }\r\n            });\r\n            LwgAni3D.moveZ(Role.ins.cameraPoint, roadLen, time1, this);\r\n        }\r\n    }\r\n    StateControl.Destination = Destination;\r\n    class Victory {\r\n        constructor() {\r\n            Victory.ins = this;\r\n        }\r\n        action() {\r\n            Laya.timer.once(1500, this, () => {\r\n                LwgEvent.notify(GameEvent.victory);\r\n            });\r\n        }\r\n    }\r\n    StateControl.Victory = Victory;\r\n    class Dance {\r\n        constructor() {\r\n            Dance.ins = this;\r\n        }\r\n        action(args, continueCb) {\r\n            MoveCrosswise.ins.isDestination = true;\r\n            const time2 = 200;\r\n            GameData.Sound.playSoundByID(17);\r\n            Role.ins.playAniCrossFade(GameEnum.RoleAni.dance);\r\n            LwgAni3D.rotateTo(Role.ins.role, new Laya.Vector3(0, -180, 0), 200, this);\r\n            Laya.timer.once(1500, this, () => {\r\n                continueCb && continueCb();\r\n            });\r\n            LwgAni3D.moveToX(Role.ins.role, 0, time2, this);\r\n            LwgAni3D.moveToX(Role.ins.cameraPoint, 0, time2, this);\r\n        }\r\n    }\r\n    StateControl.Dance = Dance;\r\n    class Defeated {\r\n        constructor() {\r\n            Defeated.ins = this;\r\n        }\r\n        action() {\r\n            Laya.timer.once(1500, this, () => {\r\n                LwgEvent.notify(GameEvent.defeated);\r\n            });\r\n        }\r\n    }\r\n    StateControl.Defeated = Defeated;\r\n})(StateControl || (StateControl = {}));\r\n",
  "references": [
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/ui/layaMaxUI.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Lwg/Lwg.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameData.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameEnum.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameEvent.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameRes.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameType.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Game3D/Effect3D.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Game3D/MainScene.ts"
  ]
}

{
  "code": "import { LwgTools } from \"../../Lwg/Lwg\";\r\nimport { GameData } from \"../Control/GameData\";\r\nimport { GameRes } from \"../Control/GameRes\";\r\nimport { SceneBase } from \"./SceneBase\";\r\nexport class EndLessScene extends SceneBase {\r\n    constructor() {\r\n        super(GameRes.Scene3D.EndLess.instance);\r\n        this.lvData = [];\r\n        EndLessScene.ins = this;\r\n    }\r\n    ready() {\r\n        this.showbase();\r\n        this.creatStartUnit();\r\n        this.unitDynamicallyAdd();\r\n        this.unitHideAndShow();\r\n    }\r\n    clear() {\r\n        this.hideBase();\r\n    }\r\n    creatStartUnit() {\r\n        const dataArr = GameData.Level.getEndlessLvData();\r\n        this.lvFoodName = GameData.Level.getEndlessLvFood();\r\n        this.lvData = dataArr;\r\n        for (let i = 0; i < 2; i++) {\r\n            const unitObj = dataArr[i];\r\n            this.createUnit(unitObj.name, unitObj.length);\r\n            this.unitIndex = i;\r\n        }\r\n        LwgTools.Node.destroyAllChildren(this.marginParent);\r\n        for (let j = -2; j < 0; j++) {\r\n            this.marginIndex = j;\r\n            this.createMargin();\r\n        }\r\n    }\r\n    createUnit(name, length) {\r\n        this.mileageTotal += length;\r\n        this.endUnit = GameRes.Prefab3D[name].instance.clone();\r\n        this.unitParent.addChild(this.endUnit);\r\n        this.endUnit.transform.position = new Laya.Vector3(0, 0, this.mileageTotal);\r\n        this.changeFood();\r\n    }\r\n    createMargin() {\r\n        this.endMargin = GameRes.Prefab3D.margin2.instance.clone();\r\n        this.marginParent.addChild(this.endMargin);\r\n        this.endMargin.transform.position = new Laya.Vector3(0, 0, this.marginIndex * 200);\r\n    }\r\n    unitDynamicallyAdd() {\r\n        Laya.timer.frameLoop(30, this, () => {\r\n            if (this.endUnit.transform.position.z - this.camaraPoint.transform.position.z < 50) {\r\n                const unitObj = this.lvData[this.unitIndex];\r\n                if (unitObj) {\r\n                    this.unitIndex++;\r\n                    this.createUnit(unitObj.name, unitObj.length);\r\n                }\r\n            }\r\n            if (this.endMargin.transform.position.z - this.camaraPoint.transform.position.z < 50) {\r\n                this.marginIndex++;\r\n                this.createMargin();\r\n                console.log('增加两边');\r\n            }\r\n        });\r\n    }\r\n    changeFood() {\r\n        for (let index = 0; index < this.endUnit.numChildren; index++) {\r\n            const child = this.endUnit.getChildAt(index);\r\n            if (child['newFood']) {\r\n                continue;\r\n            }\r\n            let newFood;\r\n            if (child.name.substr(0, 5) === 'FoodB' || child.name.substr(0, 5) === 'FoodA') {\r\n                newFood = GameRes.Prefab3D[this.lvFoodName].instance.clone();\r\n                this.endUnit.addChild(newFood);\r\n                newFood.transform.position = child.transform.position.clone();\r\n                newFood['newFood'] = true;\r\n                child.active = false;\r\n            }\r\n            if (child.name.substr(0, 5) === 'FoodC') {\r\n                const eff = GameRes.Prefab3D.effect_BadFood.instance.clone();\r\n                child.addChild(eff);\r\n            }\r\n        }\r\n    }\r\n    unitHideAndShow() {\r\n        Laya.timer.frameLoop(1, this, () => {\r\n            if (this.unitIndex > 4) {\r\n                for (let i = 0; i < this.unitParent.numChildren; i++) {\r\n                    const unit = this.unitParent.getChildAt(i);\r\n                    if (this.camaraPoint.transform.localPositionZ - unit.transform.position.z > 80) {\r\n                        unit.destroy(true);\r\n                    }\r\n                }\r\n            }\r\n            if (this.marginIndex > 4) {\r\n                if (this.marginParent.numChildren > 2) {\r\n                    for (let j = 0; j < this.marginParent.numChildren; j++) {\r\n                        const margin = this.marginParent.getChildAt(j);\r\n                        if (this.camaraPoint.transform.localPositionZ - margin.transform.position.z > 120) {\r\n                            margin.destroy(true);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Lwg/Lwg.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameData.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameRes.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameType.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Game3D/MainScene.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Game3D/SceneBase.ts"
  ]
}

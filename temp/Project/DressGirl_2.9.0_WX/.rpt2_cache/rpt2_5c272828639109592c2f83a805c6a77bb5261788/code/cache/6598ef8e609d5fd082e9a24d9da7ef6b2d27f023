{
  "code": "import { LwgAni2D, LwgControl, LwgDate, LwgScene } from \"../../Lwg/Lwg\";\r\nimport { GameEvent } from \"../Control/GameEvent\";\r\nimport GameSceneName from \"../Control/GameSceneName\";\r\nimport { GameData } from \"../Control/GameData\";\r\nimport { Control3D } from \"../Game3D/Control3D\";\r\nimport { GameEnum } from \"../Control/GameEnum\";\r\nexport default class Levels extends LwgScene.SceneBase {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.roleLv = 1;\r\n        this.lastTime = 0;\r\n        this.lastPlusOrMinus = 0;\r\n        this.lastNum = 0;\r\n        this.clickNum = 1;\r\n    }\r\n    get curScore() {\r\n        return this['_curScore'] ? this['_curScore'] : 0;\r\n    }\r\n    set curScore(val) {\r\n        this['_curScore'] = val;\r\n    }\r\n    get bubblesNum() {\r\n        return this['_bubblesNum'] ? this['_bubblesNum'] : 0;\r\n    }\r\n    set bubblesNum(val) {\r\n        this['_bubblesNum'] = val;\r\n        this.owner.lbBubblesNum.text = val.toString();\r\n    }\r\n    get mileage() {\r\n        return this['_mileage'] ? this['_mileage'] : 0;\r\n    }\r\n    set mileage(val) {\r\n        this['_mileage'] = Math.floor(val);\r\n        this.owner.lbMileage.text = this['_mileage'] + 'm';\r\n    }\r\n    get diamondNum() {\r\n        return this['_diamondNum'] ? this['_diamondNum'] : 0;\r\n    }\r\n    set diamondNum(val) {\r\n        this.owner.lbDiamondNum.text = 'x' + val;\r\n        this['_diamondNum'] = val;\r\n    }\r\n    lwgOnAwake() {\r\n        this.curScore = 0;\r\n    }\r\n    lwgOnStart() {\r\n        Control3D.start(this.openData.sprint);\r\n        this.setLevelProgress();\r\n        this.updateKey();\r\n        if (GameData.Level.mode === GameEnum.LevelMode.endless) {\r\n            this.owner.boxLv.visible = false;\r\n            this.owner.boxKey.visible = false;\r\n            this.owner.imgDiamond.visible = true;\r\n            this.owner.imgDiamond.pos(60, 149);\r\n        }\r\n        else {\r\n            this.owner.boxEndless.visible = false;\r\n            this.owner.imgDiamond.pos(67, 70);\r\n        }\r\n    }\r\n    setLevelProgress() {\r\n        this.owner.lbCurLevel.text = LwgControl.Game.levelDisplay.toString();\r\n    }\r\n    lwgEvent() {\r\n        this.evRegister(GameEvent.updateRoleDataDisplay, (pos) => {\r\n            this.owner.boxRoleData.pos(pos.x, pos.y - 120);\r\n        });\r\n        this.evRegister(GameEvent.readyVSBOSS, () => {\r\n            this.owner.boxLv.visible = false;\r\n            this.owner.boxRoleData.visible = false;\r\n        });\r\n        this.evRegister(GameEvent.hideRoleHP, () => {\r\n            this.owner.boxRoleData.visible = false;\r\n        });\r\n        this.evRegister(GameEvent.showRoleHP, () => {\r\n            this.owner.boxRoleData.visible = true;\r\n        });\r\n        this.evRegister(GameEvent.storageNum, (num) => {\r\n            this.bubblesNum = num;\r\n        });\r\n        this.evRegister(GameEvent.bubblesNum, (bubblesNum, num, rainbowEnergyPer) => {\r\n            if (bubblesNum < 0) {\r\n                bubblesNum = 0;\r\n            }\r\n            if (num > 0) {\r\n                this.bubblesNum += num;\r\n                if (GameData.Level.mode === GameEnum.LevelMode.endless) {\r\n                    this.diamondNum = this.bubblesNum;\r\n                }\r\n            }\r\n            this.showContinuousNum(num);\r\n            if (!this.startShowNum) {\r\n                this.startShowNum = true;\r\n            }\r\n            this.owner.imgRainbowEnergy.y = this.owner.imgRainbowEnergy.height * (1 - rainbowEnergyPer);\r\n        });\r\n        this.evRegister(GameEvent.reduceStorage, (time1, time2) => {\r\n            this.owner.imgDiamond.visible = true;\r\n            Laya.timer.once(time1, this, () => {\r\n                LwgAni2D.move(this.owner.imgRainbowEnergy, this.owner.imgRainbowEnergy.x, this.owner.imgRainbowEnergy.height, time2);\r\n            });\r\n            this.owner.btnReturn.visible = false;\r\n        });\r\n        this.evRegister(GameEvent.updateLvSchedule, (per, mileage) => {\r\n            this.owner.levelProgress.mask.width = per * 280;\r\n            this.mileage = mileage;\r\n        });\r\n        this.evRegister(GameEvent.victory, () => {\r\n            this.owner.boxRoleData.visible = false;\r\n            const openData = {\r\n                score: this.diamondNum,\r\n            };\r\n            this.openScene(GameSceneName.Victory, openData);\r\n        });\r\n        this.evRegister(GameEvent.defeated, () => {\r\n            const data = {\r\n                diamondNum: this.bubblesNum,\r\n                mileage: this.mileage,\r\n            };\r\n            if (GameData.Level.mode === GameEnum.LevelMode.endless) {\r\n                Laya.timer.once(1000, this, () => {\r\n                    this.openScene(GameSceneName.EndLessSettle, data);\r\n                });\r\n            }\r\n            else {\r\n                this.openScene(GameSceneName.Defeated);\r\n            }\r\n        });\r\n        this.evRegister(GameEvent.Resurgence, (type) => {\r\n            const data = {\r\n                type: type,\r\n            };\r\n            this.openOverlayScene(GameSceneName.Resurgence, data);\r\n        });\r\n        this.evRegister(GameEvent.updateDiamond, (num) => {\r\n            this.diamondNum = num;\r\n        });\r\n        this.evRegister(GameEvent.hideStorage, (num) => {\r\n            this.owner.boxStorage.visible = false;\r\n        });\r\n        this.evRegister(GameEvent.pickedKey, () => {\r\n            GameData.Lottery.KeyNum++;\r\n            this.updateKey();\r\n        });\r\n    }\r\n    showContinuousNum(num) {\r\n        if (!this.startShowNum) {\r\n            return;\r\n        }\r\n        Laya.timer.clearAll(this.owner.lbContinuousNum);\r\n        this.owner.lbContinuousNum.visible = true;\r\n        const time = 1000;\r\n        if (LwgDate.Now.time - this.lastTime < time) {\r\n            if (this.lastPlusOrMinus > 0 && num > 0) {\r\n                this.lastNum += num;\r\n            }\r\n            else if (this.lastPlusOrMinus < 0 && num < 0) {\r\n                this.lastNum += num;\r\n            }\r\n            else {\r\n                this.lastNum = num;\r\n            }\r\n        }\r\n        else {\r\n            this.lastNum = num;\r\n        }\r\n        if (num < 0) {\r\n            this.owner.aniBeAttacked.play(0, false);\r\n        }\r\n        this.lastPlusOrMinus = num;\r\n        this.lastTime = LwgDate.Now.time;\r\n        if (this.lastNum > 0) {\r\n            this.owner.lbContinuousNum.text = '+' + this.lastNum;\r\n            this.owner.lbContinuousNum.strokeColor = '#37db21';\r\n            if (this.lastNum === 1) {\r\n                GameData.Sound.playSoundByID(11);\r\n            }\r\n            else if (this.lastNum === 2) {\r\n                GameData.Sound.playSoundByID(12);\r\n            }\r\n            else if (this.lastNum === 3) {\r\n                GameData.Sound.playSoundByID(13);\r\n            }\r\n            else if (this.lastNum >= 4) {\r\n                GameData.Sound.playSoundByID(14);\r\n            }\r\n        }\r\n        else if (this.lastNum === 0) {\r\n            this.owner.lbContinuousNum.visible = false;\r\n        }\r\n        else {\r\n            this.owner.lbContinuousNum.text = this.lastNum.toString();\r\n            this.owner.lbContinuousNum.strokeColor = '#db2f21';\r\n        }\r\n        this.owner.aniContinuousNum.play(0, false);\r\n        Laya.timer.once(time, this.owner.lbContinuousNum, () => {\r\n            this.owner.lbContinuousNum.visible = false;\r\n        });\r\n    }\r\n    lwgButton() {\r\n        this.btnOnceUp(this.owner.btnReturn, () => {\r\n            this.openScene(GameSceneName.Start, null, true);\r\n        });\r\n    }\r\n    updateKey() {\r\n        for (let index = 1; index < 4; index++) {\r\n            if (index > GameData.Lottery.KeyNum) {\r\n                this.owner[`key${index}`].visible = false;\r\n            }\r\n            else {\r\n                this.owner[`key${index}`].visible = true;\r\n            }\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Lwg/Lwg.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameRes.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameEvent.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/ui/layaMaxUI.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameSceneName.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameType.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameData.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Game3D/Control3D.ts",
    "E:/svn/泡泡/Bubble_Laya_2.9.0/Project/src/script/Game/Control/GameEnum.ts"
  ]
}

{
  "code": "import { LwgAni3D, LwgControl, LwgEvent, LwgTools } from \"../../Lwg/Lwg\";\r\nimport { GameData } from \"../Control/GameData\";\r\nimport { GameEnum } from \"../Control/GameEnum\";\r\nimport { GameEvent } from \"../Control/GameEvent\";\r\nimport { GameRes } from \"../Control/GameRes\";\r\nexport class SceneBase {\r\n    constructor(scene) {\r\n        this.unitDataArr = [];\r\n        this.mileageUnit = 0;\r\n        this.mileageTotal = 0;\r\n        this._mileageCur = 0;\r\n        this.scene = scene;\r\n        Laya.stage.addChild(this.scene);\r\n        this.camaraPoint = this.scene.getChildByName('CameraPoint');\r\n        this.mainCamara = this.camaraPoint.getChildByName('Main Camera');\r\n        if (Laya.Browser.pixelRatio >= 16 / 9) {\r\n            this.mainCamara.fieldOfView += 5;\r\n        }\r\n        const mainCamaraP = this.mainCamara.transform.position;\r\n        this.mainCamaraFP = new Laya.Vector3(mainCamaraP.x, mainCamaraP.y, mainCamaraP.z);\r\n        this.directionalLight = this.camaraPoint.getChildByName('Directional Light');\r\n        this.road888 = this.scene.getChildByName('Road_888');\r\n        this.unitParent = new Laya.Sprite3D;\r\n        this.unitParent.name = 'unitParent';\r\n        this.scene.addChild(this.unitParent);\r\n        this.marginParent = new Laya.Sprite3D;\r\n        this.marginParent.name = 'marginParent';\r\n        this.scene.addChild(this.marginParent);\r\n    }\r\n    get mileageCur() {\r\n        return this._mileageCur;\r\n    }\r\n    set mileageCur(val) {\r\n        this._mileageCur = val;\r\n        if (GameData.Level.mode === GameEnum.LevelMode.common) {\r\n            if (this._mileageCur > this.mileageTotal) {\r\n                this._mileageCur = this.mileageTotal;\r\n            }\r\n        }\r\n        LwgEvent.notify(GameEvent.updateLvSchedule, [this._mileageCur / this.mileageTotal, this._mileageCur]);\r\n    }\r\n    showbase() {\r\n        Laya.timer.clearAll(this);\r\n        this.mileageTotal = 0;\r\n        this.mileageUnit = 0;\r\n        this.mileageCur = 0;\r\n        this.road888.active = true;\r\n        this.unitIndex = 0;\r\n        this.marginIndex = -2;\r\n        this.Start();\r\n        this.unitAdd();\r\n        this.unitDestory();\r\n        LwgEvent.register(GameEvent.addMileageCur, this, (num) => {\r\n            this.mileageCur += num;\r\n        });\r\n    }\r\n    Start() {\r\n        LwgTools.Node.destroyAllChildren(this.marginParent);\r\n        LwgTools.Node.destroyAllChildren(this.unitParent);\r\n        for (let i = 0; i < 2; i++) {\r\n            this.createUnit();\r\n        }\r\n        this.createMargin();\r\n    }\r\n    createMargin() {\r\n        if (GameData.Level.mode === GameEnum.LevelMode.common) {\r\n            this.endMargin = GameRes.Prefab3D.marginCommon.instance.clone();\r\n        }\r\n        else {\r\n            this.endMargin = GameRes.Prefab3D.marginEndless.instance.clone();\r\n        }\r\n        this.marginParent.addChild(this.endMargin);\r\n        this.endMargin.transform.position = new Laya.Vector3(0, 0, this.marginIndex * 200);\r\n        this.marginIndex++;\r\n    }\r\n    createUnit() {\r\n        const unitData = this.unitDataArr[this.unitIndex];\r\n        if (!unitData) {\r\n            return;\r\n        }\r\n        if (unitData.name === 'unit_999') {\r\n            this.endUnit = GameRes.Prefab3D[unitData.name].instance.clone();\r\n            this.unitParent.addChild(this.endUnit);\r\n            this.endUnit.transform.position = new Laya.Vector3(0, 0, this.mileageUnit);\r\n            this.mileageUnit += unitData.length;\r\n            this.unitIndex++;\r\n            this.changeBoss();\r\n        }\r\n        else {\r\n            const childDataArr = GameData.LevelsMsg.getChildDataArrByUnitName(unitData.name);\r\n            if (childDataArr) {\r\n                this.endUnit = new Laya.Sprite3D;\r\n                this.endUnit.name = unitData.name;\r\n                this.unitParent.addChild(this.endUnit);\r\n                this.endUnit.transform.position = new Laya.Vector3(0, 0, this.mileageUnit);\r\n                this.mileageUnit += unitData.length;\r\n                this.unitIndex++;\r\n                for (let index = 0; index < childDataArr.length; index++) {\r\n                    const childData = childDataArr[index];\r\n                    let res = this.resCorrespondingFood(childData.name);\r\n                    if (!res) {\r\n                        res = this.resCorresponding(childData.name);\r\n                    }\r\n                    if (!res) {\r\n                        console.log('不存在', childData.name);\r\n                        return false;\r\n                    }\r\n                    let child = res.clone();\r\n                    child.transform.position = new Laya.Vector3(childData.data.localPositionX, childData.data.localPositionY, childData.data.localPositionZ);\r\n                    child.transform.localRotationEuler = new Laya.Vector3(childData.data.localRotationEulerX, childData.data.localRotationEulerY, childData.data.localRotationEulerZ);\r\n                    child.transform.localScale = new Laya.Vector3(childData.data.localScaleX, childData.data.localScaleY, childData.data.localScaleZ);\r\n                    child.active = childData.active;\r\n                    this.endUnit.addChild(child);\r\n                    if (child.name.substr(0, 5) === 'FoodC') {\r\n                        this.addDecayEffect(child);\r\n                    }\r\n                    if (GameData.Level.mode === GameEnum.LevelMode.common) {\r\n                        if (child.name.substr(0, 5) === 'FoodA') {\r\n                            if (this.roleType == GameEnum.RoleType.meat) {\r\n                                this.addDecayEffect(child);\r\n                            }\r\n                        }\r\n                        else if (child.name.substr(0, 5) === 'FoodB') {\r\n                            if (this.roleType == GameEnum.RoleType.vegan) {\r\n                                this.addDecayEffect(child);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    resCorrespondingFood(name) {\r\n        let res;\r\n        if (name.substr(0, 5) === 'FoodA') {\r\n            res = GameRes.Prefab3D.FoodA01.instance;\r\n        }\r\n        else if (name.substr(0, 5) === 'FoodB') {\r\n            res = GameRes.Prefab3D.FoodB01.instance;\r\n        }\r\n        return res;\r\n    }\r\n    resCorresponding(name) {\r\n        let res;\r\n        if (name.substr(0, 5) === 'FoodC') {\r\n            res = GameRes.Prefab3D.FoodC01.instance;\r\n        }\r\n        else if (name.substr(0, 6) === 'good02') {\r\n            res = GameRes.Prefab3D.good02.instance;\r\n        }\r\n        else if (name.substr(0, 11) === 'Road_Base') {\r\n            res = GameRes.Prefab3D.Road_Base.instance;\r\n        }\r\n        else if (name.substr(0, 11) === 'Road_Base02') {\r\n            res = GameRes.Prefab3D.Road_Base02.instance;\r\n        }\r\n        else if (name.substr(0, 10) === 'Road_Start') {\r\n            res = GameRes.Prefab3D.Road_Start.instance;\r\n        }\r\n        else if (name.substr(0, 9) === 'RoadMen01') {\r\n            res = GameRes.Prefab3D.RoadMen01.instance;\r\n        }\r\n        else if (name.substr(0, 9) === 'RoadMen02') {\r\n            res = GameRes.Prefab3D.RoadMen02.instance;\r\n        }\r\n        else if (name.substr(0, 12) === 'RoadYanJiang') {\r\n            res = GameRes.Prefab3D.RoadYanJiang.instance;\r\n        }\r\n        else if (name.substr(0, 9) === 'RondomEgg') {\r\n            res = GameRes.Prefab3D.RondomEgg.instance;\r\n        }\r\n        else if (name.substr(0, 15) === 'Scenc_zhangai01') {\r\n            res = GameRes.Prefab3D.Scenc_zhangai01.instance;\r\n        }\r\n        return res;\r\n    }\r\n    addDecayEffect(food) {\r\n        const eff = GameRes.Prefab3D.effect_BadFood.instance.clone();\r\n        food.addChild(eff);\r\n        const middle = food.getChildByName('middle');\r\n        if (middle) {\r\n            const model = food.getChildByName('middle').getChildAt(0);\r\n            const mat = model.meshRenderer.material;\r\n            mat.albedoColor = new Laya.Vector4(0.5, 0.5, 0.5, 1);\r\n        }\r\n    }\r\n    changeFood() { }\r\n    ;\r\n    changeBoss() { }\r\n    ;\r\n    unitAdd() {\r\n        Laya.timer.frameLoop(1, this, () => {\r\n            if (this.endUnit && this.endUnit.transform) {\r\n                if (this.endUnit.transform.position.z - this.camaraPoint.transform.position.z < 50) {\r\n                    if (this.createUnit()) {\r\n                        if (LwgControl.Game.level !== 1 && GameData.Level.mode === GameEnum.LevelMode.common) {\r\n                            let time = 200;\r\n                            this.endUnit.transform.localPositionY -= 20;\r\n                            LwgAni3D.moveToY(this.endUnit, 3, time, this, null, () => {\r\n                                LwgAni3D.moveToY(this.endUnit, 0, time / 2, this, null, () => {\r\n                                });\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            let dis = 120;\r\n            if (GameData.Level.mode === GameEnum.LevelMode.endless) {\r\n                dis = 0;\r\n            }\r\n            if (this.endMargin && this.endMargin.transform) {\r\n                if (this.camaraPoint.transform.position.z - this.endMargin.transform.position.z > dis) {\r\n                    this.createMargin();\r\n                }\r\n            }\r\n        });\r\n    }\r\n    unitDestory() {\r\n        Laya.timer.frameLoop(10, this, () => {\r\n            if (LwgControl.Game.level !== 1) {\r\n                if (this.unitIndex > 2) {\r\n                    for (let i = 0; i < this.unitParent.numChildren; i++) {\r\n                        const unit = this.unitParent.getChildAt(i);\r\n                        if (unit.name !== 'Road999') {\r\n                            if (this.camaraPoint.transform.localPositionZ - unit.transform.position.z > 80) {\r\n                                unit.destroy(true);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (this.marginIndex > 2) {\r\n                    if (this.marginParent.numChildren > 1) {\r\n                        for (let j = 0; j < this.marginParent.numChildren; j++) {\r\n                            const margin = this.marginParent.getChildAt(j);\r\n                            if (this.camaraPoint.transform.localPositionZ - margin.transform.position.z > 100) {\r\n                                margin.destroy(true);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    hideBase() {\r\n        LwgEvent.offAllCaller(this);\r\n        Laya.timer.clearAll(this);\r\n        LwgTools.Node.destroyAllChildren(this.marginParent);\r\n        LwgTools.Node.destroyAllChildren(this.unitParent);\r\n    }\r\n}\r\n",
  "references": [
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Lwg/Lwg.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameData.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameEnum.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameEvent.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameRes.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameType.ts"
  ]
}

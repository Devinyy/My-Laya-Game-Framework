{
  "code": "import { ui } from \"../../../ui/layaMaxUI\";\r\nimport { LwgDialogue, LwgScene, LwgTimer, LwgDate, LwgWX } from \"../../Lwg/Lwg\";\r\nimport { GameData } from \"../Control/GameData\";\r\nimport { GameEnum } from \"../Control/GameEnum\";\r\nimport { GameEvent } from \"../Control/GameEvent\";\r\nimport GameSceneName from \"../Control/GameSceneName\";\r\nexport default class LuckyWheel extends LwgScene.SceneBase {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.firstRewardAngle = 22.5;\r\n        this.isDoTurning = false;\r\n        this.turnLaps = 5;\r\n        this.turnOneTime = 1000;\r\n    }\r\n    lwgOnAwake() {\r\n        this.setRewardData();\r\n        this.playAutoTurn();\r\n    }\r\n    lwgOnStart() {\r\n        this.evNotify(GameEvent.updateKeLuckyWheelBtn);\r\n    }\r\n    lwgEvent() {\r\n        this.evRegister(GameEvent.updateKeLuckyWheelBtn, () => {\r\n            this.displayNum();\r\n        });\r\n    }\r\n    displayNum() {\r\n        if (GameData.LuckyWheel.todayFree) {\r\n            this.owner.lbNum.text = 1 + '次';\r\n            this.owner.imgWordTurn.visible = false;\r\n            this.owner.imgWordFree.visible = true;\r\n        }\r\n        else {\r\n            this.owner.imgWordTurn.visible = true;\r\n            this.owner.imgWordFree.visible = false;\r\n            this.owner.lbNum.text = 0 + '次';\r\n        }\r\n    }\r\n    lwgButton() {\r\n        this.btnOnUp(this.owner.btnFree, () => {\r\n            if (this.isDoTurning) {\r\n                LwgDialogue.showTips('等一下呗');\r\n            }\r\n            else {\r\n                if (GameData.LuckyWheel.todayFree) {\r\n                    GameData.LuckyWheel.lastDate = LwgDate.Now.date;\r\n                    this.playTurn();\r\n                    this.displayNum();\r\n                }\r\n                else {\r\n                    LwgWX.AD.showVideo(() => {\r\n                        this.playTurn();\r\n                    });\r\n                }\r\n            }\r\n        });\r\n        this.btnOnUp(this.owner.btnLater, () => {\r\n            if (this.isDoTurning) {\r\n                LwgDialogue.showTips('请稍等！');\r\n            }\r\n            else {\r\n                this.closeScene();\r\n                Laya.Tween.clearAll(this.owner.rewardContent);\r\n            }\r\n        });\r\n    }\r\n    setRewardData() {\r\n        const arr = GameData.LuckyWheel.getItemArr;\r\n        const num = arr.length;\r\n        for (let index = 0; index < num; index++) {\r\n            const rewardUI = new ui.Views.LuckyWheelRenderObjUI;\r\n            this.owner.rewardContent.addChild(rewardUI);\r\n            rewardUI.rotation = index * 360 / num + this.firstRewardAngle;\r\n            rewardUI.name = `${index}`;\r\n            rewardUI.pos(this.owner.rewardContent.width / 2, this.owner.rewardContent.height / 2);\r\n            const item = arr[index];\r\n            rewardUI.icon.skin = item.picSkin;\r\n            rewardUI.num.text = item.number.toString();\r\n            if (item.type === GameEnum.ItemType.Skin) {\r\n                rewardUI.num.visible = false;\r\n                rewardUI.icon.scale(0.6, 0.6);\r\n            }\r\n            else {\r\n                rewardUI.num.visible = true;\r\n                rewardUI.icon.scale(1, 1);\r\n            }\r\n        }\r\n    }\r\n    playTurn() {\r\n        this.stopAutoTurn();\r\n        this.isDoTurning = true;\r\n        GameData.Sound.playSoundByID(4);\r\n        let angle = 0;\r\n        const item = GameData.LuckyWheel.ranReward;\r\n        const index = item.index;\r\n        angle = index * (360 / 8) + this.firstRewardAngle;\r\n        const time = this.turnLaps * this.turnOneTime + Math.floor(angle / 360 * this.turnOneTime);\r\n        Laya.Tween.to(this.owner.rewardContent, { rotation: 360 * this.turnLaps - angle }, time, Laya.Ease.cubicOut, Laya.Handler.create(this, () => {\r\n            GameData.Sound.playSoundByID(5);\r\n            this.owner.rewardContent.rotation = 360 - angle;\r\n            if (item.type == GameEnum.ItemType.LuckyWheelAgain) {\r\n                LwgDialogue.showTips('抽奖次数+1！');\r\n                GameData.LuckyWheel.lastDate = 0;\r\n                this.isDoTurning = false;\r\n            }\r\n            else {\r\n                const openData = {\r\n                    itme: item,\r\n                };\r\n                Laya.timer.once(1000, this, () => {\r\n                    this.openOverlayScene(GameSceneName.BeRewarded, openData);\r\n                    this.isDoTurning = false;\r\n                    this.playAutoTurn();\r\n                });\r\n            }\r\n        }));\r\n    }\r\n    playAutoTurn() {\r\n        LwgTimer.frameLoop(1, this.owner.rewardContent, () => {\r\n            this.owner.rewardContent.rotation += 0.05;\r\n        });\r\n    }\r\n    stopAutoTurn() {\r\n        Laya.timer.clearAll(this.owner.rewardContent);\r\n    }\r\n}\r\n",
  "references": [
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/ui/layaMaxUI.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Lwg/Lwg.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameAni2D.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameData.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameEnum.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameEvent.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameSceneName.ts",
    "E:/svn/恐龙跑酷/DinosaursGrow_Laya_2.9.0/DinosaursGrowUp_2.9.0/src/script/Game/Control/GameType.ts"
  ]
}
